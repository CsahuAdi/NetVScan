from typing import Dict
from cve_lookup import search_cve

def assess_vulnerabilities(enriched_services: dict) -> dict:
    """
    Takes detected services & banners and assigns risk levels and notes.
    Returns enriched dict:
    {
        port: {
            'service': str,
            'banner': str,
            'risk': str,
            'notes': str
        }
    }
    """
    results = {}
    for port, info in enriched_services.items():
        service = info['service']
        banner = info['banner']
        vulns = search_cve(service, banner)
        results[port] = {
            'service': service,
            'banner': banner,
            'cves': vulns
        }
    return results

# Example usage
if __name__ == "__main__":
    # Simulated input from service_detector.py
    enriched_services = {
        22: {'service': 'SSH', 'banner': 'SSH-2.0-OpenSSH_8.2'},
        21: {'service': 'FTP', 'banner': '220-FileZilla Server ready'},
        8000: {'service': 'HTTP', 'banner': ''}
    }

    results = assess_vulnerabilities(enriched_services)

    for port, info in results.items():
        print(f"Port {port}: {info['service']} | Risk: {info['risk']} | Notes: {info['notes']}")
